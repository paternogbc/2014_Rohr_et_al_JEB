
---
title: 'Supporting Information: Background Noise as a Selective Pressure: Anuran Species
  from Lotic Environments Call at Higher Pitches'
author: David Lucas R??hr; Gustavo B. Paterno; Felipe Camurugi; Flora A. Junc?? ; Adrian
  A. Garda
date: "December 17, 2014"
output: pdf_document
toc: true
theme: "united"
---
\newpage

>All Data and code required to repeat the analysis bellow are linked at: [raw data](https://github.com/paternogbc/2014_Rohr_et_al_JEB/blob/master/raw.data_Rhor_JEB.txt), [source code](https://github.com/paternogbc/2014_Rohr_et_al_JEB/blob/master/Rhor_JEB_2014_source_code.R) and ready to be executed. Thus this reserach reaches the gold standard of reprodibility for full replication (Peng, 2011). This documment was generated in __R studio__ with `kintr` package and all files and documentation are available at this [Github repo](link). 

1. Packages versions:
===============================
install.packages("ape")
```{r packages,message=FALSE,echo=FALSE}
library(ape);library(caper);library(phytools);library(knitr)
library(dplyr);library(ggplot2);library(picante);library(gridExtra)
```

We used 'r info[1]$R$ver' and packages:
```{r versions, echo=FALSE}
info <- sessionInfo()
info[1]$R$ver
info$other
str(info)

```

info <- sessionInfo()
info[1]$R$ver


```{r species data entry,echo=F,results='hide'}
# Entrada de dados:
mat <- read.table("raw.data_Rhor_JEB.txt",h=T)
```
```{r phylogeny data entry,echo=F,results='hide'}
arvore<-read.tree("amph_2014.tre")
anura<-drop.tip(arvore,as.character(mat[,1]))             
filo<-(drop.tip(arvore,anura$tip.label))
filo$node.label 
filo$node.label <- makeLabel(filo)$node.label 
comp.data <- comparative.data(phy=filo,data=mat,names.col="sp",vcv=T,vcv.dim=3)
```

\newpage

2. Data structure:
=================

I. Species data 
---------------
The species dataset contain six variables (see Methods for detailed information and [raw data](https://gist.github.com/paternogbc/d73612e22c36e538ee54) to download data.
  
variable  | discription
--------- | -----------
sp        | species name
environment| Reproductive environment (lentic or lotic)
DF| Dominant frequency (hertz)
SVL|snout vent length (mm)
logDF| log10 of dominant frequency (DF)
logSVL| log10 of snout vent length (SVL)

Specis data structure
---------------------  
Last six rows of the species dataset:

```{r,echo=F}
kable(tail(mat))
str(mat)
```

II. Phylogeny
------------
The phylogenetic tree used in this paper was pruned from: [Pyron and Wiens (2014)](http://www.sciencedirect.com/science/article/pii/S105579031100279X) anura super tree. The pruned tree with study species (509) is available at: [study tree](https://github.com/paternogbc/2014_Rohr_et_al_JEB/blob/master/phy_Rohr_JEB_2014.tre).  

Phylogeny structure
-------------------

```{r,echo=F,fig.height=6}
filo
comp.data$data$sp <- comp.data$tip.label
plot(comp.data[[1]],"fan",show.tip.label=T,cex=0.08,label.offset=1.2,
     lab4ut="axial")
tiplabels(frame="circle",col=comp.data$data$environment,
          pch=c(16,16),cex=0.3)
legend(legend=c("running","still"),pch=c(16,16),col=c("red","black"),
       "topleft",bty="n")
```

\newpage

3. Data summary:
================

A. Mean and standard deviation for Dominant frequency and Sout-vent-length
--------------------------------------------------------------------------
```{r data summery0,echo=F}
mat.summ <- summarise(group_by(mat,environment),meanDF=mean(DF),seDF=sd(DF),
                meanSVL=mean(SVL),seSVL=sd(SVL))
kable(mat.summ)
```

B. Dominant Frequency and Snout-Vent-Length distribution
--------------------------------------------------------
    
```{r datasummary1, message=FALSE,warning=FALSE,echo=FALSE,fig.height=4,fig.width=6,error=FALSE}
## DF:
g1 <- ggplot(mat,aes(x=logDF,fill=environment))+
geom_histogram(alpha=.5,position="identity")+
geom_vline(data=data.frame(mat.summ),aes(xintercept=log10(meanDF),colour=environment),linetype="dashed", size=1)+
xlab("Dominant Frequency (hertz)[log10]")+
theme(legend.position = c(0.2,.8),
      legend.background=element_rect("transparent"))

## SVL:
g2 <- ggplot(mat,aes(x=logSVL,fill=environment))+
geom_histogram(alpha=.5,position="identity")+
geom_vline(data=data.frame(mat.summ),aes(xintercept=log10(meanSVL),colour=environment),linetype="dashed", size=1)+
xlab("Sount-vent-Length (mm)[log10]")+
theme(legend.position = "none")
grid.arrange(g1,g2,ncol=2)
```

\newpage

4. Phylogenetic signal 
======================
We used K statistics to test the phylogentic signal for Dominant Frequency (*logDF*) and Snout-vent-length(*logSVL*)(for details about the method, see [Blomberg et al (2003)](http://onlinelibrary.wiley.com/doi/10.1111/j.0014-3820.2003.tb00285.x/abstract)). 

```{r}
k.signal <- multiPhylosignal(select(comp.data$data,logDF,logSVL),comp.data$phy,reps=999)
kable(k.signal)
```
  
Dominant Frequency and Snout-Vent-Length show significant phylogenetic signal, however, K values are low.  

5. Phylogenetic generalized least square 
========================================
We used a phylogenetic generalized least square model (PGLS) with dominant frequency as the response variable and reproduction habitat (lentic/lotic) and SVL as the explanatory variables to test if dominant frequency was affected by reproduction environment. Dominant frequencies and body sizes were log transformed (log10) before the analysis. To optimize branch length transformation, the lambda value was set by maximum likelihood (see [Freckleton et al., 2002](http://www.jstor.org/stable/10.1086/343873); [Orme et al., 2013](http://cran.r-project.org/web/packages/caper/vignettes/caper.pdf) for details). PGLS analysis were performed with the function `pgls` from the package `caper`.

A. Data preparation:
--------------------
Using the function `comparative.data` we combined our phylogenie with the species dataset
```{r,echo=FALSE}
comp.data <- comparative.data(phy=filo,data=mat,names.col="sp",vcv=T,vcv.dim=3)
comp.data 
```

A. Checking the phylogenetic signal of the residuals from stantard OLS regression
---------------------------------------------------------------------------------
In order to check the need to include the phylogeny in our analysis, first it is important to check if there is phylogenetic signal in the residuals of an Ordinary Least Square regression (OSL) (Kamilar & Cooper, 2013; Freckleton, 2009).

Fitting OSL regression (formula = logDF ~ environment*logSVL):
```{r,echo=FALSE,message=FALSE,warning=FALSE}
mod.osl <- lm(logDF ~ environment*logSVL,mat)
# Extracting residuals from the model:
comp.data$data$lm.res <- residuals(mod.osl)
osl.resi.sig <- phylosignal(comp.data$data$lm.res,reps=999,comp.data$phy)
kable(osl.resi.sig)
```

Since the residuals from OSL regression show phylogenetic signal k = `r round(as.numeric(osl.resi.sig[1]),digits=2)`, there is strong need to correct for phylogenetic nonindependence in data.  

B. Data analysis:
--------------------
Fitting pgls model with with lambda adjusted by maximum likelihood:
```{r}
mod.pgls <- pgls(logDF ~ environment*logSVL, data=comp.data,lambda="ML")
summary(mod.pgls)
```

**ANOVA table**
```{r,echo=FALSE}
kable(anova(mod.pgls))
```

Confidence interval for lambda estimation: 
```{r,fig.height=4,fig.width=4}
profile.lambda <- pgls.profile(mod.pgls)
plot(profile.lambda)
```

C. Model diagnostic:
--------------------

I. Standard graphic methods for model diagnostics   

```{r,echo=F}
par(mfrow=c(2,2))
plot(mod.pgls)
```
Residulas do not show any tendency. 

II. Phylogenetic signal of model residuals  
After performing PGLS analysis it is important to check the phylogenetic signal of  model residuals ([reference](link))

```{r,warning=FALSE,message=FALSE}
k.residuals <- phylosignal(mod.pgls$phyres,reps=999,comp.data$phy)
kable(k.residuals)
```
  
Results above shows that the residuals do not present significant phylogenetic signal.


D. Model comparison: OSL vs PGLS
--------------------
```{r}
kable(AIC(mod.osl,mod.pgls))
```

AIC comparison shows that PGLS model has much lower AIC value (`r AIC(mod.osl,mod.pgls)[2,2]`) then OSL model (`r AIC(mod.osl,mod.pgls)[1,2]`). Thus, PGLS model is a better fit for the data.  

\newpage

6. References
=============
1. Pyron, R.A. & Wiens, J.J. 2011 A large-scale phylogeny of Amphibia including over 2800 species, and a revised classification of extant frogs, salamanders, and caecilians. Molecular Phylogenetics and Evolution 61, 543-583.  
2. Blomberg, S. P., T. Garland, Jr., and A. R. Ives. 2003. Testing for phylogenetic signal in comparative data: behavioral traits are more labile. Evolution 57:717-745.  
3. David Orme, Rob Freckleton, Gavin Thomas, Thomas Petzoldt, Susanne Fritz,
  Nick Isaac and Will Pearse (2013). caper: Comparative Analyses of
  Phylogenetics and Evolution in R. R package version 0.5.2.
  http://CRAN.R-project.org/package=caper   
4. Kamilar JM, Cooper N. 2013 Phylogenetic signal in primate behaviour, ecology and life history. Phil Trans R Soc B 368: 20120341. http://dx.doi.org/10.1098/rstb.2012.0341
5. Freckleton, R.P. (2009) The seven deadly sins of comparative analysis. J Evol Biol, 22, 1367-1375.  

\newpage

7. Links summary:
=================

1. [raw data](https://gist.github.com/paternogbc/d73612e22c36e538ee54)    
2. [source code](https://github.com/paternogbc/2014_Rohr_et_al_JEB)   
3. [species list](https://github.com/paternogbc/2014_Rohr_et_al_JEB/blob/master/species_list.csv)  
4. [Study phylogeny](https://github.com/paternogbc/2014_Rohr_et_al_JEB)   

***

